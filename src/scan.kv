#:kivy 1.9.1
###################################################################################

<StartScreen>:
  powerOff: power_off
  titleLabel: title_label
  name: 'start'
  Label:
    pos_hint: {'center_x': 0.5, 'center_y': 0.1}
    id: power_off
    font_size: 24
    markup: True
    text: ''

  AnchorLayout:
    anchor_x: 'left'
    anchor_y: 'top'
    Button:
      size_hint: (0.2, 0.1)
      text: 'Quit to Console'
      on_press: root.quit()

  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.5)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    spacing: 20

    Label:
      id: title_label
      font_size: 48
      text: 'Pi Scan'

    Button:
      text: 'Begin'
      on_press:
        root.manager.transition.direction = 'left'
        root.manager.current = 'configure-disk'

###################################################################################

<ConfigureDiskScreen>:
  diskStatus: disk_status
  diskNext: disk_next
  spinner: spinner
  name: 'configure-disk'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.9)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    spacing: 20

    Label:
      id: disk_status
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 36
      markup: True
      text: 'Searching for storage...'
    Image:
      id: spinner
      source: 'spinner.gif'
      anim_delay: 1.0/6.0

  RelativeLayout:
    size_hint: (1, 0.15)
    pos_hint: {'center_x': 0.5}
    AnchorLayout:
      anchor_x: 'right'
      anchor_y: 'bottom'
      Button:
        id: disk_next
        size_hint: (0.2, 1)
        text: 'Next'
        on_press:
          root.manager.transition.direction = 'left'
          root.manager.current = 'configure-camera'
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Back'
        on_press:
          root.manager.transition.direction = 'right'
          root.manager.current = 'start'

###################################################################################

<ConfigureCameraScreen>:
  cameraLabel: camera_label
  cameraNext: camera_next
  searchingLayout: searching_layout
  foundLayout: found_layout
  name: 'configure-camera'
  RelativeLayout:
    id: searching_layout
    BoxLayout:
      orientation: 'vertical'
      size_hint: (0.9, 0.9)
      pos_hint: {'center_x': 0.5, 'center_y': 0.5}

      Label:
        id: camera_label
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 36
        markup: True
        text: 'Searching for cameras...'
      Image:
        id: spinner
        width: 66
        height: 66
        source: 'spinner.gif'
        anim_delay: 1.0/6.0

  RelativeLayout:
    id: found_layout
    BoxLayout:
      orientation: 'vertical'
      size_hint: (0.9, 0.9)
      pos_hint: {'center_x': 0.5, 'center_y': 0.5}
      Label:
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 36
        markup: True
        text: 'Found two cameras. Click next to continue.'
      Button:
        size_hint: 0.3, 0.2
        pos_hint: {'center_x': 0.5}
        text: 'Adjust Camera Zoom'
        on_press:
          root.manager.transition.direction = 'left'
          root.manager.current = 'zoom-camera'

  RelativeLayout:
    size_hint: (1, 0.15)
    pos_hint: {'center_x': 0.5}
    AnchorLayout:
      anchor_x: 'right'
      anchor_y: 'bottom'
      Button:
        id: camera_next
        size_hint: (0.2, 1)
        text: 'Next'
        on_press:
          root.next()
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Back'
        on_press:
          root.manager.transition.direction = 'right'
          root.manager.current = 'configure-disk'

###################################################################################

<ZoomCameraScreen>:
  preview: preview
  noPreviewLabel: no_preview_label
  evenControl: even_control
  oddControl: odd_control
  name: 'zoom-camera'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.85)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    spacing: 10

    RelativeLayout:
      size_hint: (1, 0.1)
      AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        Label:
          size_hint: (1, 1)
          text_size: self.size
          halign: 'center'
          valign: 'middle'
          font_size: 18
          text: 'Even <-- Zoom --> Odd'
      AnchorLayout:
        anchor_x: 'left'
        anchor_y: 'top'
        Spinner:
          size_hint: (0.3, 1)
          id: even_control
          text: '5'
          values: ('Min Zoom', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'Max Zoom')  
      AnchorLayout:
        anchor_x: 'right'
        anchor_y: 'top'
        Spinner:
          size_hint: (0.3, 1)
          text: '5'
          id: odd_control
          values: ('Min Zoom', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'Max Zoom')  
    PreviewOutside:
      id: preview
      size_hint: (1, 0.95)

  RelativeLayout:
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'center'
      Label:
        id: no_preview_label
        size_hint: (1, 0.5)
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 36
        text: 'Pick a Zoom Level and tap Test Shot to see what it looks like.'

  RelativeLayout:
    size_hint: (1, 0.15)
    AnchorLayout:
      anchor_x: 'right'
      anchor_y: 'bottom'
      Button:
        id: camera_next
        size_hint: (0.2, 1)
        text: 'Done'
        on_press:
          root.done()
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Test Shot'
        on_press:
          root.test()

###################################################################################

<FocusCameraScreen>:
  preview: preview
  noPreviewLabel: no_preview_label
  cameraNext: camera_next
  cameraRefocus: camera_refocus
  cameraSwap: camera_swap
  cameraLabel: camera_label
  name: 'focus-camera'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.85)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    spacing: 10

    Label:
      size_hint: (1, 0.05)
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      id: camera_label
      font_size: 24
      text: 'Camera Configuration'

    PreviewOutside:
      id: preview
      size_hint: (1, 0.95)

  RelativeLayout:
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'center'
      Label:
        id: no_preview_label
        size_hint: (1, 0.1)
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 36
        text: 'Press Pages Against Glass and Tap Refocus'

  RelativeLayout:
    size_hint: (1, 0.15)
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      BoxLayout:
        orientation: 'horizontal'
        size_hint: (0.5, 1)
        spacing: 10
        Button:
          id: camera_refocus
          size_hint: (0.5, 1)
          pos_hint: {'center_x': 0.5}
          text: 'Refocus'
          on_press:
            root.refocus()
        Button:
          id: camera_swap
          size_hint: (0.5, 1)
          pos_hint: {'center_x': 0.5}
          text: 'Swap'
          on_press:
            root.swap()
    AnchorLayout:
      anchor_x: 'right'
      anchor_y: 'bottom'
      Button:
        id: camera_next
        size_hint: (0.2, 1)
        text: 'Next'
        on_press:
          root.next()
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Back'
        on_press:
          root.done()
          root.manager.transition.direction = 'right'
          root.manager.current = 'configure-camera'

###################################################################################

<PreviewOutside>:
  odd: odd
  oddLabel: odd_label
  even: even
  evenLabel: even_label
  scatter: scatter
  ScatterLayout:
    id: scatter
    canvas.before:
      ScissorPush:
        x: self.parent.x
        y: self.parent.y + self.parent.height * 0.15
        width: self.parent.width
        height: self.parent.height * 0.8
    canvas.after:
      ScissorPop
    do_collide_after_children: False
    do_rotation: False
    auto_bring_to_front: False
    BoxLayout:
      orientation: 'horizontal'
      size_hint: (1, 0.8)
      pos_hint: { 'center_y': 0.6 }

      BoxLayout:
        orientation: 'vertical'
        size_hint: (0.5, 1)
        Label:
          id: even_label
          font_size: 18
          text_size: self.size
          halign: 'center'
          valign: 'middle'
          size_hint: (1, 0.05)
          text: 'Even Page'
        PreviewInside:
          id: even
      BoxLayout:
        orientation: 'vertical'
        size_hint: (0.5, 1)
        Label:
          id: odd_label
          font_size: 18
          text_size: self.size
          halign: 'center'
          valign: 'middle'
          size_hint: (1, 0.05)
          text: 'Odd Page'
        PreviewInside:
          id: odd
  AnchorLayout:
    anchor_x: 'right'
    anchor_y: 'top'
    BoxLayout:
      orientation: 'vertical'
      size_hint: (0.1, 0.5)
      Button:
        size_hint: (1, 0.33)
        text: '+'
        on_press: root.zoomIn()
      Button:
        size_hint: (1, 0.33)
        text: '-'
        on_press: root.zoomOut()
      Button:
        size_hint: (1, 0.33)
        text: '0'
        on_press: root.zoomZero()

###################################################################################

<PreviewInside>:
  size_hint_y: 1.0
  size_hint_x: None
  pos_hint: { 'center_x': 0.5 }
  cols: 3

###################################################################################

<CaptureScreen>:
  preview: preview
  captureButton: capture
  rescanButton: rescan
  previewButton: preview_button
  name: 'capture'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.85)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    spacing: 10

    Label:
      size_hint: (1, 0.05)
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      id: camera_label
      font_size: 24
      text: 'Ready For Capture'

    PreviewOutside:
      id: preview
      size_hint: (1, 0.95)

  RelativeLayout:
    size_hint: (1, 1)
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'center'
      Button:
        id: preview_button
        size_hint: (0.3, 0.1)
        text: 'Show Preview'
        on_press:
          root.showPreview()

  RelativeLayout:
    size_hint: (1, 0.2)
    AnchorLayout:
      anchor_x: 'right'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Done'
        on_press:
          root.done()
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      Button:
        id: capture
        size_hint: (0.4, 1)
        text: 'Capture'
        on_press:
          root.capture()
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        id: rescan
        size_hint: (0.2, 1)
        text: 'Rescan'
        on_press:
          root.rescan()

###################################################################################

<CaptureWaitScreen>:
  name: 'capture-wait'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.85)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    Label:
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 36
      text: 'Capturing...'
    Image:
      id: spinner
      width: 66
      height: 66
      source: 'spinner.gif'
      anim_delay: 1.0/6.0
  RelativeLayout:
    size_hint: (1, 0.1)
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Restart Pi Scan'
        on_press:
          exit()

###################################################################################

<PreviewWaitScreen>:
  name: 'preview-wait'
  BoxLayout:
    orientation: 'vertical'
    size_hint: (0.9, 0.85)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    Label:
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 36
      text: 'Generating Preview...'
    Image:
      id: spinner
      width: 66
      height: 66
      source: 'spinner.gif'
      anim_delay: 1.0/6.0
  RelativeLayout:
    size_hint: (1, 0.1)
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Restart Pi Scan'
        on_press:
          exit()

###################################################################################

<CaptureFailScreen>:
  evenLabel: even_label
  oddLabel: odd_label
  name: 'capture-fail'
  BoxLayout:
    size_hint: (0.95, 1)
    orientation: 'vertical'
    Label:
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 36
      text: 'Capture Failed.'
    Label:
      id: even_label
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 24
      markup: True
      text: 'even camera: '
    Label:
      id: odd_label
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 24
      markup: True
      text: 'odd camera: '
    Button:
      size_hint: (0.1, 0.2)
      pos_hint: { 'center_x': 0.5 }
      text: 'Ok'
      on_press:
        root.ok()
  RelativeLayout:
    size_hint: (1, 0.1)
    AnchorLayout:
      anchor_x: 'left'
      anchor_y: 'bottom'
      Button:
        size_hint: (0.2, 1)
        text: 'Restart Pi Scan'
        on_press:
          exit()

###################################################################################

<CrashScreen>:
  name: 'crash'
  errorLabel: error_label
  BoxLayout:
    orientation: 'vertical'
    size_hint: (1, 1)
    Label:
      id: error_label
      font_size: 12
      text_size: self.size
      halign: 'left'
      valign: 'middle'
      text: 'Pi Scan Crashed'
    Button:
      size_hint: (0.2, 0.05)
      text: 'Restart Pi Scan'
      on_press:
        root.restart()

###################################################################################

<DebugScreen>:
  evenStatus: even_status
  evenLog: even_log
  evenMessage: even_message
  oddStatus: odd_status
  oddLog: odd_log
  oddMessage: odd_message
  okButton: ok
  name: 'debug'
  BoxLayout:
    size_hint: (0.95, 1)
    orientation: 'vertical'
    Label:
      size_hint: (1.0, 0.1)
      font_size: 36
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      text: 'Camera Crashed.'
    BoxLayout:
      size_hint: (1.0, 0.2)
      orientation: 'horizontal'
      Label:
        font_size: 24
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        text: 'Even Camera'
      Label:
        id: even_status
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 24
        markup: True
        text: 'Searching...'
      Button:
        id: even_log
        text: 'Get Debug Log'
        on_press:
          root.getEvenLog()
    Label:
      size_hint: (1.0, 0.1)
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      id: even_message
      font_size: 24
      text: ''
    Label:
      size_hint: (1.0, 0.1)
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      font_size: 36
      text: '---------------------'
    BoxLayout:
      size_hint: (1.0, 0.2)
      orientation: 'horizontal'
      Label:
        font_size: 24
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        text: 'Odd Camera'
      Label:
        id: odd_status
        text_size: self.size
        halign: 'center'
        valign: 'middle'
        font_size: 24
        markup: True
        text: 'Searching...'
      Button:
        id: odd_log
        text: 'Get Debug Log'
        on_press:
          root.getOddLog()
    Label:
      id: odd_message
      text_size: self.size
      halign: 'center'
      valign: 'middle'
      size_hint: (1.0, 0.1)
      font_size: 24
      text: ''
    RelativeLayout:
      size_hint: (1, 0.2)
      AnchorLayout:
        anchor_x: 'right'
        anchor_y: 'bottom'
        Button:
          id: ok
          size_hint: (0.2, 1)
          text: 'Ok'
          on_press:
            root.ok()
      AnchorLayout:
        anchor_x: 'left'
        anchor_y: 'bottom'
        Button:
          size_hint: (0.2, 1)
          text: 'Restart Pi Scan'
          on_press:
            exit()

###################################################################################

<ScanRoot>:
  StartScreen:
  ConfigureDiskScreen:
  ConfigureCameraScreen:
  ZoomCameraScreen:
  FocusCameraScreen:
  CaptureScreen:
  CaptureWaitScreen:
  PreviewWaitScreen:
  CaptureFailScreen:
  DebugScreen:
  CrashScreen:
